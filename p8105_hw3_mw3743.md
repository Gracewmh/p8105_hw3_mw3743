HW3 Visualization and EDA
================
Minghui Wang
2024-10-10

[Homework 3](https://p8105.com/homework_3.html) reinforces ideas in
Visualization and
[EDA](https://p8105.com/topic_visualization_and_eda.html). Here are the
codes focusing on question 1-3.

# Question1

## Import the data:

``` r
library(p8105.datasets)
data("ny_noaa")
```

## EDA and descriptionn

``` r
ny_noaa|>
  head() |>
  knitr::kable()
```

| id          | date       | prcp | snow | snwd | tmax | tmin |
|:------------|:-----------|-----:|-----:|-----:|:-----|:-----|
| US1NYAB0001 | 2007-11-01 |   NA |   NA |   NA | NA   | NA   |
| US1NYAB0001 | 2007-11-02 |   NA |   NA |   NA | NA   | NA   |
| US1NYAB0001 | 2007-11-03 |   NA |   NA |   NA | NA   | NA   |
| US1NYAB0001 | 2007-11-04 |   NA |   NA |   NA | NA   | NA   |
| US1NYAB0001 | 2007-11-05 |   NA |   NA |   NA | NA   | NA   |
| US1NYAB0001 | 2007-11-06 |   NA |   NA |   NA | NA   | NA   |

``` r
ny_noaa|>
  dim()
```

    ## [1] 2595176       7

``` r
 ny_noaa |>
  group_by(id) |> 
  summarize(
    n_obs = n())|> 
  arrange(n_obs)
```

    ## # A tibble: 747 × 2
    ##    id          n_obs
    ##    <chr>       <int>
    ##  1 US1NYCN0011    30
    ##  2 US1NYES0005    30
    ##  3 US1NYSF0030    30
    ##  4 US1NYDT0007    31
    ##  5 US1NYSF0049    31
    ##  6 US1NYST0033    31
    ##  7 US1NYWC0009    31
    ##  8 USC00306411    31
    ##  9 USC00303076    59
    ## 10 USC00304525    59
    ## # ℹ 737 more rows

``` r
 ny_noaa |>
  ggplot(aes(x = prcp)) +
  geom_histogram()
```

    ## Warning: Removed 145838 rows containing non-finite outside the scale range
    ## (`stat_bin()`).

<img src="p8105_hw3_mw3743_files/figure-gfm/Initial numeric explorations of prcp -1.png" width="90%" />

``` r
 ny_noaa |>
  ggplot(aes(x = snwd)) +
  geom_histogram()
```

    ## Warning: Removed 591786 rows containing non-finite outside the scale range
    ## (`stat_bin()`).

<img src="p8105_hw3_mw3743_files/figure-gfm/Initial numeric explorations of snowday-1.png" width="90%" />

``` r
 ny_noaa |>
   filter( snwd >= 50)|>
  ggplot(aes(x = snwd)) +
  geom_histogram()
```

<img src="p8105_hw3_mw3743_files/figure-gfm/Initial numeric explorations of snowday-2.png" width="90%" />

``` r
ny_noaa_df = ny_noaa |>
  mutate(
    tmax = as.numeric(tmax) / 10, 
    tmin = as.numeric(tmin) / 10
  ) 

 ny_noaa_df |>
  ggplot(aes(x = tmax)) +
  geom_histogram()
```

    ## Warning: Removed 1134358 rows containing non-finite outside the scale range
    ## (`stat_bin()`).

<img src="p8105_hw3_mw3743_files/figure-gfm/Initial numeric explorations tmax-1.png" width="90%" />

``` r
 ny_noaa_df |>
  ggplot(aes(x = tmin)) +
  geom_histogram()
```

    ## Warning: Removed 1134420 rows containing non-finite outside the scale range
    ## (`stat_bin()`).

<img src="p8105_hw3_mw3743_files/figure-gfm/Initial numeric explorations tmin-1.png" width="90%" />

## Data description

This dataset has 7 variables recording 2595176 entries.The data records
different cities’ weather information, including key variables like
date, precipitation and snow condition, snow day, maxium and mininum
temperature at that day.After EDA, we find tha precipitation and snow
are very skewed distribution; any formal analyses involving them as a
predictor or outcome might be influenced by this fact. It’s important to
note that the vast majority of days have no precipitation or snow.
Meanwhile, examining the relatively few days have very high
precipitation and snow might be helpful.

## Answer questions

1.  Do some data cleaning. Create separate variables for year, month,
    and day. Ensure observations for temperature, precipitation, and
    snowfall are given in reasonable units.

``` r
ny_noaa_cleaned_df =
  ny_noaa_df |> # already change the variable type of tin and tmax in EDA steps.
  drop_na(prcp) |>
  mutate(
    year = year(date) ,
    month = month(date),
    day = day(date)
  ) 
```

- For snowfall, what are the most commonly observed values? Why?
  - For snowfall, the most commonly observed value are “NA” or zero for
    it is not common the be snowy alot in New York.

2.  Make a two-panel plot showing the average max temperature in January
    and in July in each station across years.

``` r
ny_noaa_cleaned_df |>
  filter(month %in% c(1, 7)) |>
  group_by(id, year, month)|>
  summarize(
    mean_tmax = mean(tmax, na.rm = TRUE)) |>
  mutate(
    month_name = case_match(
      month,
      1 ~ "January",
      7 ~ "July"
    )  ) |>
  ggplot(aes(x = year, y = mean_tmax)) + 
  geom_point(alpha = .3) + 
  geom_line()+ 
  facet_grid(. ~ month_name)+
  labs(
    x = "Year", 
    y = "Mean Maximum Temp (C)",
    title = "Average Max Temperature in January and in July in Each Station Across Years",
  ) + 
  theme_minimal() + 
  theme(legend.position = "bottom")
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

    ## Warning: Removed 5911 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

<img src="p8105_hw3_mw3743_files/figure-gfm/q1.2  two-panel plot showing the average max temperature in January and in July-1.png" width="90%" /> -
Is there any observable / interpretable structure? Any outliers? - Yes.
The plot shows that July has higher average maximum temperatures than
January over the years, which is expected. There is no big change in
temperature trends over time, which suggests stable patterns for these
months. However, there are some unusual points, especially in January,
where temperatures drop much lower than the others. This might mean
there were very cold days or maybe data mistakes. In July, there are
fewer unusual points, but one or two cooler days stand out. These
unusual points should be checked further to see if they are correct.

3.  Make a two-panel plot showing

<!-- -->

1)  tmax vs tmin for the full dataset (note that a scatterplot may not
    be the best option);
2)  make a plot showing the distribution of snowfall values greater than
    0 and less than 100 separately by year.

``` r
ggp_tmax_tmin = 
ny_noaa_cleaned_df |> 
  drop_na(tmax, tmin) |>
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex(alpha = .3)+
  labs(
    x = "Minimum Temperature (°F)",
    y = "Maximum Temperature (°F)",
    title = "Relationship Between Tmax and Tmin"
  ) +
  theme_minimal()

ggp_snwd_yr =
  ny_noaa_cleaned_df |> 
  filter(snwd > 0 & snwd < 100) |> 
  ggplot(aes(x = year, y = snwd)) + 
  geom_point(alpha = .3) + 
  geom_smooth(se = FALSE)+
  labs(
    x = "Year",
    y = "Snow Depth (mm)",
    title = "Distribution of Snow Depth for Values Between 0 and 100 mm by Year"
  ) +
  theme_minimal()

ggp_tmax_tmin + ggp_snwd_yr 
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

<img src="p8105_hw3_mw3743_files/figure-gfm/unnamed-chunk-2-1.png" width="90%" />

# Question 2

## 2.1 Load, tidy, merge the datasets

``` r
# Load, tidy the demographic df
accel_demo_df =
  read.csv("data/nhanes_covar.csv",skip = 4, na = c("NA", ".","")) |>
  janitor::clean_names()|>
  # exclude participants less than 21 years of age
  filter(age >= 21)|>
  # exclude  those with missing demographic data
  drop_na()|>
  # encode data with reasonable variable classes
  mutate(
    sex = as.character(sex),        
    sex = case_match(
      sex,
      "1" ~ "male",
      "2" ~ "female"
    ),
    education = as.character(education), 
    education = case_match(
      education,
      "1" ~ "less than high school",
      "2" ~ "high school equivalent",
      "3" ~ "more than high school"
    )
  )

# Load, tidy the Variables df
accel_var_df =
  read.csv("data/nhanes_accel.csv", na = c("NA", ".","")) |>
  janitor::clean_names()|>
  pivot_longer(
    cols = min1:min1440, 
    names_to = "minute",
    values_to = 'mims_value',
  )|>
  mutate(minute = as.numeric(sub("min", "", minute))) 

# Merge to table based on demographic df
accel_df =
  left_join(accel_demo_df, accel_var_df, by = "seqn")
```

## 2.2 Demographic table

### 2.2.1 Table for the number of men and women in each education category,

``` r
accel_df |>  
  group_by(sex, education) |>
  summarize(category_count = n()/1440, .groups = "drop")|>  
  pivot_wider(
    names_from = education,
    values_from  = category_count
    ) |>
  knitr::kable()
```

| sex    | high school equivalent | less than high school | more than high school |
|:-------|-----------------------:|----------------------:|----------------------:|
| female |                     23 |                    28 |                    59 |
| male   |                     35 |                    27 |                    56 |

### 2.2.2 Visualization of the age distributions for men and women in each education category

``` r
accel_df |>  
  mutate(education = factor(education, levels = c("less than high school", 
                                                  "high school equivalent", 
                                                  "more than high school"))) |>
  ggplot(aes(x = sex, y=age, fill = education)) + 
  geom_boxplot() +
  labs(title = "Age Distributions by Sex and Education Level",
      x = "Sex",
      y = "Age") +
  scale_y_continuous(
    limits = c(20, 85),
    breaks = c(20,30,40,50,60,70,80)
  )+
  scale_fill_brewer(palette = "Set3") +
  theme_minimal()
```

<img src="p8105_hw3_mw3743_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" /> -
Comment on these items: This box plot shows the age distributions for
men and women in different education categories. For both men and women,
those with “more than high school” seem to have a slightly younger age
range compared to the other two education levels. The median ages for
“high school equivalent” are a bit higher for females whild for man ages
for “high school equivalent” are a bit lower.

## 2.3 Total activity variable

Using your tidied dataset, aggregate across minutes to create a total
activity variable for each participant. Plot these total activities
(y-axis) against age (x-axis); your plot should compare men to women and
have separate panels for each education level. Include a trend line or a
smooth to illustrate differences. Comment on your plot.

``` r
accel_df |>  
  mutate(education = factor(education, levels = c("less than high school", 
                                                  "high school equivalent", 
                                                  "more than high school"))
         ) |>
  # Create a total activity variable for each participant
  group_by(seqn, sex, age, education) |>
  summarize(total_activities = sum(mims_value, na.rm = TRUE))|>
  # Age-total_activity plot compare men to women 
  ggplot(aes(x = age, y=total_activities, color = sex)) + 
  geom_point(alpha=.3) +
  # Include a trend line or a smooth to illustrate differences
  geom_smooth(se = FALSE) +
  # Have separate panels for each education level
  facet_grid(. ~ education)+ 
  labs(title = "Total Activity vs. Age by Sex and Education Level",
       x = "Age",
       y = "Total Activity") +
  scale_color_brewer(palette = "Set1")+
  theme_minimal()
```

    ## `summarise()` has grouped output by 'seqn', 'sex', 'age'. You can override
    ## using the `.groups` argument.
    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

<img src="p8105_hw3_mw3743_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" /> -
Comments: This plot shows total activity levels by age for men and women
across three education levels. In the “less than high school” group,
activity decreases with age, especially for men. The “high school
equivalent” group has more ups and downs in activity, while the “more
than high school” group shows steadier activity across ages. Women
generally have slightly higher activity in younger ages across all
levels. Among “high school equivalent” and “more than high school”
group, women consistantly have more daily activity than men across all
ages.
